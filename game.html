<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>보이스피싱</title>
    <link rel="stylesheet" href="gameStyle.css" />
    <style>
      /* 상단 디스플레이 컨테이너 */
      .display-container {
        position: absolute;
        top: 10px; /* 화면 상단에 약간의 여백 */
        left: 0;
        width: 100%;
        text-align: center;
        z-index: 1;
      }

      /* 디스플레이 항목 */
      .display {
        font-size: 18px;
        color: white;
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <div class="aspect-ratio-box">
      <!-- 캐릭터와 낚시바늘 -->
      <div class="character-container" id="character-container">
        <img
          src="TempPlayer.png"
          alt="캐릭터"
          class="character"
          id="character"
          style="left: 30%; transform: translateX(-50%)"
        />
        <img
          src="fishHook.png"
          alt="낚시바늘"
          class="fish-hook"
          id="fish-hook"
          style="left: 50%; top: 100px"
        />
      </div>
      <div class="content">
        <!-- 상단 디스플레이 표시 -->
        <div class="display-container">
          <div class="display">남은 시간: 60</div>
          <div class="display">획득 골드: 6000</div>
        </div>
        <!-- 하단 버튼 -->
        <div class="button-container">
          <button class="button" id="left-button">◀</button>
          <button class="button" id="down-button">▼</button>
          <button class="button" id="right-button">▶</button>
        </div>
      </div>
    </div>

    <script>
      const characterContainer = document.getElementById("character-container");
      const fishHook = document.getElementById("fish-hook");
      let position = 30; // 초기 위치 (%)
      let moveInterval; // 이동 interval
      let isMoving = false; // 이동 여부 확인

      // 초기 위치 설정
      characterContainer.style.left = position + "%"; // 부모 컨테이너 위치 설정

      // 캐릭터와 낚시바늘 이동 함수
      function moveCharacter(direction) {
        if (direction === "left") {
          position -= 1; // 왼쪽으로 이동
          if (position < 0) position = 0;
        } else if (direction === "right") {
          position += 1; // 오른쪽으로 이동
          if (position > 100) position = 100;
        }
        characterContainer.style.left = position + "%"; // 부모 컨테이너 이동
      }

      // 버튼이 눌렸을 때 이동 시작
      function startMoving(direction) {
        if (isMoving) return;
        isMoving = true;
        moveCharacter(direction); // 즉시 이동
        moveInterval = setInterval(() => moveCharacter(direction), 50);
      }

      // 이동 중지
      function stopMoving() {
        clearInterval(moveInterval);
        moveInterval = null;
        isMoving = false;
      }

      // 낚시바늘 내려가기 함수
      function dropFishHook() {
        const initialTop = parseInt(window.getComputedStyle(fishHook).top, 10);
        const dropDistance = 500; // 내려갈 거리(px)
        let currentTop = initialTop;
        const dropInterval = setInterval(() => {
          currentTop += 5; // 낚시바늘 내려감
          fishHook.style.top = currentTop + "px";
          if (currentTop >= initialTop + dropDistance) {
            clearInterval(dropInterval); // 목표 거리 도달 시 정지
            liftFishHook(initialTop); // 낚시바늘 올리기
          }
        }, 20);
      }

      // 낚시바늘 올리기 함수
      function liftFishHook(initialTop) {
        let currentTop = parseInt(window.getComputedStyle(fishHook).top, 10);
        const liftInterval = setInterval(() => {
          currentTop -= 5; // 낚시바늘 올라감
          fishHook.style.top = currentTop + "px";

          // 올라가는 동안 가운데 버튼 비활성화
          downButton.disabled = true; // 버튼 비활성화

          if (currentTop <= initialTop) {
            currentTop = initialTop; // 초기 위치로 정확하게 설정
            fishHook.style.top = currentTop + "px"; // 정확한 위치로 이동
            clearInterval(liftInterval); // 초기 위치로 돌아오면 정지
            downButton.disabled = false; // 버튼 활성화
          }
        }, 20);
      }

      // 터치 이벤트 리스너 등록 (스마트폰에서 작동하도록 추가)
      const leftButton = document.getElementById("left-button");
      const rightButton = document.getElementById("right-button");
      const downButton = document.getElementById("down-button");

      // 터치 시작 시 이동 시작
      leftButton.addEventListener("touchstart", () => startMoving("left"));
      rightButton.addEventListener("touchstart", () => startMoving("right"));

      // 터치 끝나면 이동 멈춤
      leftButton.addEventListener("touchend", stopMoving);
      rightButton.addEventListener("touchend", stopMoving);
      leftButton.addEventListener("touchcancel", stopMoving);
      rightButton.addEventListener("touchcancel", stopMoving);

      // 버튼에서 손가락을 떼면 이동을 멈추게 하기 위해 mouse 이벤트를 touch로 대체
      leftButton.addEventListener("mousedown", () => startMoving("left"));
      rightButton.addEventListener("mousedown", () => startMoving("right"));
      leftButton.addEventListener("mouseup", stopMoving);
      rightButton.addEventListener("mouseup", stopMoving);
      leftButton.addEventListener("mouseleave", stopMoving);
      rightButton.addEventListener("mouseleave", stopMoving);

      // 낚시바늘 동작
      downButton.addEventListener("mousedown", dropFishHook);
      downButton.addEventListener("touchstart", dropFishHook); // 터치로도 낚시바늘 동작
    </script>
  </body>
</html>
